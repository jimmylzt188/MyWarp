######### 锚点 start #######
# 策略组相关
pr: &pr {type: select, proxies: [🔰国外流量, ♻️自动选择, ✅手动选择, 🇸🇬新加坡, 🇭🇰香港, 🇯🇵日本, 🇰🇷韩国, 🇲🇴澳门, 🇨🇳台湾, 🇺🇸美国, 🇺🇳其他, ✨Warp代理, 🏙公司代理, DIRECT, REJECT]}

#这里是订阅更新和延迟测试相关的
p: &p {type: http, interval: 3600, health-check: {enable: true, url: http://cp.cloudflare.com/generate_204, interval: 300}}
#代理组更新
pt: &pt {url: http://cp.cloudflare.com/generate_204, lazy: false, interval: 300, tolerance: 10}
# 规则订阅相关
ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}

mode: rule
ipv6: true
log-level: silent
allow-lan: true
mixed-port: 7890
unified-delay: true
tcp-concurrent: true
external-controller: 127.0.0.1:9090
secret: 7895123

geodata-mode: true
geox-url:
  geoip: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geoip.dat"
  geosite: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/country.mmdb"
# 是否自动更新 GEO 数据
geo-auto-update: true
# GEO 数据更新间隔，单位为小时
geo-update-interval: 72

find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"

tun:
  enable: true
  # MacOS推荐gvisor, system/gvisor/mixed/lwip
  stack: mixed
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  
dns:
  enable: true
  ipv6: true
  use-hosts: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - tls://223.5.5.5:853
    - https://223.6.6.6/dns-query
    - https://120.53.53.53/dns-query
    - 8.8.8.8
    - 1.1.1.1
    - 8.8.4.4

  proxy-server-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - https://dns.cloudflare.com/dns-query

  fallback:
    - https://doh.dns.sb/dns-query
    - https://dns.cloudflare.com/dns-query
    - https://dns.twnic.tw/dns-query
    - tls://8.8.4.4:853
    - tcp://1.1.1.1
    - tls://1.0.0.1:853
    - https://dns.google/dns-query
  fallback-filter:
    geoip: true
    ipcidr: [240.0.0.0/4, 0.0.0.0/32,]

proxies:
  - name: BJ_VPN
    type: socks5
    server: 127.0.0.1
    port: 8899
    skip-cert-verify: true
  - name: 公司代理ss
    type: ss
    server: 47.251.24.246
    port: 54888
    cipher: aes-256-gcm
    password: js@88888888
  - name: ZeroTrust
    type: socks5
    server: 127.0.0.1
    port: 40000
    udp: true
    #skip-cert-verify: true

# 节点配置文件统一存放在 ./profiles/proxies/ 目录中
proxy-providers:
  # 从链接导入的配置文件
  zhuri:
    <<: *p
    path: ./profiles/proxies/zhuri.yaml
    url: "https://c.zhuri.cc/link/hqmwsGpMn78jNY2q?clash=1"

  nekowarp:
    <<: *p
    path: ./profiles/proxies/nekowarp.yaml
    url: "https://neko-warp.nloli.xyz/neko_warp.yaml"

  mywarp:
    <<: *p
    path: ./profiles/proxies/mywarp.yaml
    url: "https://raw.githubusercontent.com/jimmylzt188/MyWarp/main/clash-warp.yaml?token=GHSAT0AAAAAACLRMQ32BAAJXYEC4U4JNYKSZN4PETA"

proxy-groups:
  - name: GPT代理
    type: select
    include-all-providers: true
    filter: (?i)Gpt|gpt|GPT|Chat|CHAT
    proxies: [🏙公司代理, ✨Warp代理]
  - name: 🔰国外流量
    type: select
    proxies: [♻️自动选择, ✅手动选择, 🔯故障转移, 🇸🇬新加坡, 🇭🇰香港, 🇯🇵日本, 🇰🇷韩国, 🇲🇴澳门, 🇨🇳台湾, 🇺🇸美国, 🇺🇳其他, ✨Warp代理,  🏙公司代理, REJECT]
  - name: ♻️自动选择
    type: url-test
    include-all-providers: true
    exclude-filter: ♻️自动选择|☁️|⚡
    <<: *pt
  - name: ✅手动选择
    type: select
    include-all-providers: true
    exclude-filter: ♻️自动选择|☁️|⚡
  - name: 🔯故障转移
    type: fallback
    include-all-providers: true
    <<: *pt
  - name: 🌏全球直连
    type: select
    proxies: [DIRECT, 🔰国外流量]
  - name: 🛑全球拦截
    type: select
    proxies: [REJECT, DIRECT, 🔰国外流量]
  - name: ☁️Icloud
    <<: *pr
  - name: 📱Apple
    <<: *pr
  - name: 📫Google
    <<: *pr
  - name: 📲Telegram
    <<: *pr
  - name: 📺Youtube
    <<: *pr
  - name: Ⓜ️微软服务
    <<: *pr
  - name: 🐟未命中规则
    <<: *pr
  
  # 节点自动测速
  - name: 🇭🇰香港
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)香港|hk|hongkong
  - name: 🇯🇵日本
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)日本|jap|japan
  - name: 🇰🇷韩国
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)韩国|korea|kr
  - name: 🇲🇴澳门
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)澳门|macau|macao|mo
  - name: 🇸🇬新加坡
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)(新加坡|sg|singapore)
  - name: 🇨🇳台湾
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)台湾|tw|taiwan
  - name: 🇺🇸美国
    type: url-test
    <<: *pt
    include-all-providers: true
    filter: (?i)美国|us|unitedstates|united states
  - name: 🇺🇳其他
    type: url-test
    <<: *pt
    include-all-providers: true
    exclude-filter: (?i)🇭🇰|🇯🇵|🇰🇷|🇺🇸|🇸🇬|🇨🇳|🇲🇴|⚡|香港|hk|hongkong|澳门|macau|mo|macao|台湾|tw|taiwan|日本|jp|japan|韩国|korea|kr|新加坡|sg|singapore|美国|us|unitedstates|WARP|Warp|warp
  - name: 北京代理
    type: select
    proxies: [BJ_VPN]
  - name: 🏙公司代理
    type: url-test
    <<: *pt
    proxies: [公司代理ss]
  - name: ✨Warp代理
    type: select
    use: [mywarp, nekowarp]
    proxies: [ZeroTrust]

rules:
  
  # 默认规则
  - DOMAIN-KEYWORD,aria2,DIRECT
  - DOMAIN-KEYWORD,copilot,🔰国外流量
  - DOMAIN-KEYWORD,bing,🔰国外流量
  - DOMAIN-KEYWORD,openai,GPT代理
  - DOMAIN-KEYWORD,google,🔰国外流量
  - DOMAIN-SUFFIX,appstorrent.ru,🔰国外流量
  - DOMAIN-SUFFIX,ghcr.io,🔰国外流量
  - DOMAIN-KEYWORD,brew,🔰国外流量
  - DOMAIN-SUFFIX,githubusercontent.com,🔰国外流量
  - IP-CIDR,192.168.1.181/32,北京代理
  - IP-CIDR,192.168.1.152/32,北京代理
  - IP-CIDR,10.251.0.2/32,北京代理
  - PROCESS-NAME,LemonMonitor,🔰国外流量
  - PROCESS-NAME,Terminal,🔰国外流量

  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - GEOIP,CN,DIRECT
  - PROCESS-NAME,OneDrive,Ⓜ️微软服务
  - PROCESS-NAME,OneDriveUpdater,Ⓜ️微软服务
  - DOMAIN-KEYWORD,1drv,Ⓜ️微软服务
  - DOMAIN-KEYWORD,onedrive,Ⓜ️微软服务
  - DOMAIN-KEYWORD,skydrive,Ⓜ️微软服务
  - DOMAIN-SUFFIX,livefilestore.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,oneclient.sfx.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onedrive.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onedrive.live.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,photos.live.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sharepoint.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sharepointonline.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,skydrive.wns.windows.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,spoprod-a.akamaihd.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,storage.live.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,storage.msn.com,Ⓜ️微软服务
  - DOMAIN-KEYWORD,1drv,Ⓜ️微软服务
  - DOMAIN-KEYWORD,microsoft,Ⓜ️微软服务
  - DOMAIN-SUFFIX,aadrm.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,acompli.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,acompli.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,aka.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,akadns.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,aspnetcdn.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,assets-yammer.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,azure.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,azure.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,azureedge.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,azurerms.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,cloudapp.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,cloudappsecurity.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,edgesuite.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,gfx.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,hotmail.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,live.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,live.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,lync.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msappproxy.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msauth.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msauthimages.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msecnd.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msedge.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msft.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msftauth.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msftauthimages.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msftidentity.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msidentity.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msn.cn,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msn.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msocdn.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,msocsp.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,mstea.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,o365weve.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,oaspapps.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,office.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,office.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,office365.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,officeppe.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,omniroot.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onedrive.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onenote.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onenote.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,onestore.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,outlook.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,outlookmobile.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,phonefactor.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,public-trust.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sfbassets.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sfx.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sharepoint.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sharepointonline.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,skype.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,skypeassets.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,skypeforbusiness.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,staffhub.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,svc.ms,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sway-cdn.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sway-extensions.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,sway.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,trafficmanager.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,uservoice.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,virtualearth.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,visualstudio.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,windows-ppe.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,windows.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,windows.net,Ⓜ️微软服务
  - DOMAIN-SUFFIX,windowsazure.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,windowsupdate.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,wunderlist.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,yammer.com,Ⓜ️微软服务
  - DOMAIN-SUFFIX,yammerusercontent.com,Ⓜ️微软服务
  - RULE-SET,youtube_domain,📺Youtube
  - RULE-SET,github_domain,🔰国外流量
  - RULE-SET,bahamut_domain,🇨🇳台湾
  - RULE-SET,biliintl_domain,🇭🇰香港
  - RULE-SET,lancidr,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,direct,🌏全球直连
  - RULE-SET,icloud,☁️Icloud
  - RULE-SET,apple,📱Apple
  - RULE-SET,google,📫Google
  - RULE-SET,google_domain,📫Google
  - RULE-SET,google_ip,📫Google
  - RULE-SET,reject,🛑全球拦截
  - RULE-SET,telegramcidr,📲Telegram
  - RULE-SET,telegram_domain,📲Telegram
  - RULE-SET,gfw,🔰国外流量
  - RULE-SET,proxy,🔰国外流量
  - RULE-SET,greatfire,🔰国外流量
  - RULE-SET,netflix_ip,🔰国外流量
  - RULE-SET,netflix_domain,🔰国外流量
  - RULE-SET,twitter_ip,🔰国外流量
  - RULE-SET,twitter_domain,🔰国外流量
  - RULE-SET,spotify_domain,🔰国外流量
  - RULE-SET,pixiv_domain,🔰国外流量
  - RULE-SET,gfw,🔰国外流量
  - RULE-SET,geolocation-!cn,🐟未命中规则
  - MATCH,🐟未命中规则

rule-providers:
  reject:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/reject.txt
    path: ./profiles/rules/reject.yaml
  icloud:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/icloud.txt
    path: ./profiles/rules/icloud.yaml
  apple:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/apple.txt
    path: ./profiles/rules/apple.yaml
  google:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/google.txt
    path: ./profiles/rules/google.yaml
  proxy:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/proxy.txt
    path: ./profiles/rules/proxy.yaml
  direct:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt
    path: ./profiles/rules/direct.yaml
  gfw:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt
    path: ./profiles/rules/gfw.yaml
  greatfire:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/greatfire.txt
    path: ./profiles/rules/greatfire.yaml
  tld-not-cn:
    <<: *domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/tld-not-cn.txt
    path: ./profiles/rules/tld-not-cn.yaml
  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./profiles/rules/applications.yaml
    interval: 86400
  
  telegramcidr:
    <<: *ip
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt
    path: ./profiles/rules/telegramcidr.yaml
  cncidr:
    <<: *ip
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/cncidr.txt
    path: ./profiles/rules/cncidr.yaml
  lancidr:
    <<: *ip
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/lancidr.txt
    path: ./profiles/rules/lancidr.yaml

  youtube_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.yaml
    path: ./profiles/rules/youtube.yaml
  github_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.yaml
    path: ./profiles/rules/github.yaml
  bahamut_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bahamut.yaml
    path: ./profiles/rules/bahamut.yaml
  telegram_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.yaml
    path: ./profiles/rules/telegram.yaml
  geolocation-!cn:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.yaml
    path: ./profiles/rules/geolocation-!cn.yaml
  biliintl_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/biliintl.yaml
    path: ./profiles/rules/biliintl.yaml
  google_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.yaml
    path: ./profiles/rules/googledomain.yaml
  google_ip:
    <<: *ip
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.yaml
    path: ./profiles/rules/googleip.yaml
  netflix_ip:
    <<: *ip
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.yaml
    path: ./profiles/rules/netflixip.yaml
  netflix_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.yaml
    path: ./profiles/rules/netflixdomain.yaml
  twitter_ip:
    <<: *ip
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/twitter.yaml
    path: ./profiles/rules/twitterip.yaml
  twitter_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.yaml
    path: ./profiles/rules/twitterdomain.yaml
  spotify_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.yaml
    path: ./profiles/rules/spotify.yaml
  pixiv_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/pixiv.yaml
    path: ./profiles/rules/pixiv.yaml